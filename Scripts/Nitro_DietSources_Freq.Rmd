---
title: "Nitro_DietSources"
author: "Ashlee Mikkelsen"
date: "`r Sys.Date()`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Environment

```{r}

rm(list=ls())

```

## Set Working Directory

```{r}

 setwd("C:/Users/amikk/Documents/Rprojects/BrownBearDietThroughTime")

```


## Load Packages

```{r}

library(ggplot2)
library(lme4)
library(viridis)
library(wiqid)
library(AICcmodavg)


```



## Graphing theme

```{r}

mytheme <- theme(
    axis.text = element_text(size = 10,face = "bold"),
    axis.title = element_text(size = 12, face = "bold"),
    panel.grid.major = element_line(color = "grey92"),
    panel.grid.minor = element_line(color = "grey96"),
    panel.background = element_rect(fill = "white"),
    axis.line = element_line(colour = "black",linewidth = 1),
    axis.ticks = element_line(linewidth = 1),
    legend.position = "top"
    )
theme_set(mytheme)

P <- palette(viridis(40))
P <- palette(viridis(40))


```


## Data

### Load Data

```{r}

SI_Diet <- read.csv("Data\\RawBearData_SI_Proteins.csv")

LastYr <- as.numeric(max(SI_Diet$year.represent))

SI_Diet$year.represent <- as.numeric(SI_Diet$year.represent)
SI_Diet$C13 <- as.numeric(SI_Diet$C13)

C13.suess <- SI_Diet$C13-(+0.022*(LastYr-SI_Diet$year.represent))
SI_Diet$C13.suess <- C13.suess

SI_Diet$fYEAR <- as.factor(SI_Diet$year.represent)
is.na(SI_Diet$N15)

SI_Diet <- subset(SI_Diet, N15!="NA")
SI_Diet <- subset(SI_Diet, reprostatus.represent!="NA")

names(SI_Diet)[6] <- "Repro"
names(SI_Diet)[9] <- "Mass"

SI_Diet_Mharv <- subset(SI_Diet, Moose_Harv!="NA")



```


### Standardize cont. variables

```{r}

SI_Diet_Mharv$Zyear <- standardize(SI_Diet_Mharv$year.represent)
SI_Diet_Mharv$ZN15 <- standardize(SI_Diet_Mharv$N15)
SI_Diet_Mharv$Zmass <- standardize(SI_Diet_Mharv$Mass)
SI_Diet_Mharv$Zprop_ants <- standardize(SI_Diet_Mharv$Prop_Ants)
SI_Diet_Mharv$Zprop_moose <- standardize(SI_Diet_Mharv$Prop_Moose)
SI_Diet_Mharv$Zprop_bilb <- standardize(SI_Diet_Mharv$Prop_BilBerry)
SI_Diet_Mharv$Zharvest_moose <- standardize(SI_Diet_Mharv$Moose_Harv)
SI_Diet_Mharv$Zobs_moose <- standardize(SI_Diet_Mharv$Moose_Obs)
SI_Diet_Mharv$Zcalves <- standardize(SI_Diet_Mharv$Calves)
SI_Diet_Mharv$Zbilb <- standardize(SI_Diet_Mharv$Bilberry)
SI_Diet_Mharv$Zlingon <- standardize(SI_Diet_Mharv$Lingonberry)

```



## Functions

```{r}

rsq <- function (x, y) cor(x, y) ^ 2

```

# Data distributions

## heavy nitrogen

```{r}

ggplot(data = SI_Diet_Mharv, aes(N15))+
  geom_histogram(binwidth = sd(SI_Diet_Mharv$N15))+
  scale_y_continuous(expand = c(0,0))+
  scale_x_continuous(expand = c(0,0))+
  geom_vline(xintercept = mean(SI_Diet_Mharv$N15))


ggplot(data = SI_Diet_Mharv, aes(N15, fill=fYEAR))+
  geom_histogram(binwidth = sd(SI_Diet_Mharv$N15))+
  scale_y_continuous(expand = c(0,0))+
  scale_x_continuous(expand = c(0,0))+
  geom_vline(xintercept = mean(SI_Diet_Mharv$N15),
                               linewidth=1.2)+
  scale_fill_viridis(option="B", discrete = TRUE)

```



# Linear regression models

## Model Selection setup
```{r}

NitrogenModels <- list()


```


## Intercept model

```{r}

NitrogenModels[[1]] <- IntMod <- lmer(ZN15~1+(1|BearID)+(1|Repro),
                data = SI_Diet_Mharv)

summary(IntMod)
AIcc_Int <- wiqid::AICc(IntMod)

```


## Year model

```{r}

NitrogenModels[[2]] <-YearMod <- lmer(ZN15~Zyear+(1|BearID)+(1|Repro),
                data = SI_Diet_Mharv)

summary(YearMod)
AIcc_Year <- wiqid::AICc(YearMod)

```


## Ants model

```{r}

AntMod <- lmer(ZN15~ Zprop_ants+
                  (1|BearID)+(1|Repro),
                data = SI_Diet_Mharv)

summary(AntMod)

rsq(x=SI_Diet_Mharv$Prop_Ants, y=SI_Diet_Mharv$N15)

AIcc_Ant <- wiqid::AICc(AntMod)

```


## Moose diet model

```{r}

MooseDietMod <- lmer(ZN15~ Zprop_moose+
                  (1|BearID)+(1|Repro),
                data = SI_Diet_Mharv)

summary(MooseDietMod)

rsq(x=SI_Diet_Mharv$Prop_Moose, y=SI_Diet_Mharv$N15)
AIcc_DietMoose <- wiqid::AICc(MooseDietMod)

```


## Moose harvest model

```{r}

NitrogenModels[[3]] <-MooseHarvMod <- lmer(ZN15~ Zharvest_moose+
                  (1|BearID)+(1|Repro),
                data = SI_Diet_Mharv)

summary(MooseHarvMod)

rsq(x=SI_Diet_Mharv$Moose_Harv, y=SI_Diet_Mharv$N15)
AIcc_HarvMoose <- wiqid::AICc(MooseHarvMod)

```


## Calf observation model

```{r}


NitrogenModels[[4]] <-CalfMod <- lmer(ZN15~ Zcalves+
                  (1|BearID)+(1|Repro),
                data = SI_Diet_Mharv)

summary(CalfMod)

rsq(x=SI_Diet_Mharv$Calves, y=SI_Diet_Mharv$N15)
AIcc_Calf <- wiqid::AICc(CalfMod)

```



## Moose observation model

```{r}

NitrogenModels[[5]] <-MooseObsMod <- lmer(ZN15~ Zobs_moose+
                  (1|BearID)+(1|Repro),
                data = SI_Diet_Mharv)

summary(MooseObsMod)

rsq(x=SI_Diet_Mharv$Moose_Obs, y=SI_Diet_Mharv$N15)
AIcc_ObsMoose <- wiqid::AICc(MooseObsMod)

```



## Bilberry model

```{r}

NitrogenModels[[6]] <-BilbMod <- lmer(ZN15~ Zbilb+
                  (1|BearID)+(1|Repro),
                data = SI_Diet_Mharv)

summary(BilbMod)

rsq(x=SI_Diet_Mharv$Bilberry, y=SI_Diet_Mharv$N15)

AIcc_Bilb <- wiqid::AICc(BilbMod)

```


## Lingonberry model

```{r}

NitrogenModels[[7]] <-LingMod <- lmer(ZN15~ Zlingon+
                  (1|BearID)+(1|Repro),
                data = SI_Diet_Mharv)

summary(LingMod)

rsq(x=SI_Diet_Mharv$Lingonberry, y=SI_Diet_Mharv$N15)

AIcc_Ling <- wiqid::AICc(LingMod)

```


### Model selection table

```{r}

NitroModelNames <- c("Intercept",
                     "Year",
                     "Moose Harvest",
                     "Calf Observation",
                     "Moose Observation",
                     "Bilberry Index",
                     "Lingonberry Index")

##Generate and print AICc table
print(aictab(cand.set = NitrogenModels,
             modnames = NitroModelNames,
             sort = TRUE),
      digits = 4, #round to 4 digits after decimal point
      LL = TRUE #give log-likelihood 
      )

write.csv(aictab(cand.set = NitrogenModels,
                 modnames = NitroModelNames,
                 sort = TRUE,
                 second.ord=TRUE),
          file="Results\\NitrogenModels.csv")



```



# Top model output

```{r}


InitialTop <- ggplot(data = SI_Diet,
       aes(x=Prop_Moose, y=N15))+
  geom_jitter(aes(color=fYEAR,
                 pch=reprostatus.represent),
              width=0.0002,
              size=1.5,
              alpha=0.5)+
  ylab(expression(paste(delta^15,"N (\u2030)",sep = "")))+
  xlab("Estimated proportion of Moose in Diet")+
  scale_y_continuous(expand = c(0.001,0.001))+
  scale_x_continuous(expand = c(0.001,0.001))+
  scale_color_viridis(discrete = TRUE)+
  labs(color="Year", pch="Repro status")+
  geom_text(aes(label = paste("R^(", 2, ")", sep = "")),
            size=6,
            x=0.4,y=7)
  
  
InitialTop  

ggsave(plot = InitialTop,
       "InitialTop_Moose.png",
       width = 9.5, height = 7,
       units = "in",
       dpi = 750)

```

